<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.sstc.hmis.log.dbaccess.dao.OperationLogMapper" >
  <resultMap id="BaseResultMap" type="com.sstc.hmis.log.dbaccess.data.OperationLog" >
    <!--
      WARNING - @mbggenerated
      This element is automatically generated by MyBatis Generator, do not modify.
      This element was generated on Fri Apr 20 09:22:13 CST 2018.
    -->
    <id column="cl_id" property="clId" jdbcType="VARCHAR" />
    <result column="cl_grp_id" property="clGrpId" jdbcType="VARCHAR" />
    <result column="cl_hotel_id" property="clHotelId" jdbcType="VARCHAR" />
    <result column="cl_client_ip" property="clClientIp" jdbcType="VARCHAR" />
    <result column="cl_server_ip" property="clServerIp" jdbcType="VARCHAR" />
    <result column="cl_biz_date" property="clBizDate" jdbcType="TIMESTAMP" />
    <result column="cl_system" property="clSystem" jdbcType="VARCHAR" />
    <result column="cl_modular" property="clModular" jdbcType="VARCHAR" />
    <result column="cl_fun" property="clFun" jdbcType="VARCHAR" />
    <result column="cl_operation" property="clOperation" jdbcType="VARCHAR" />
    <result column="cl_accno" property="clAccno" jdbcType="VARCHAR" />
    <result column="cl_groupno" property="clGroupno" jdbcType="VARCHAR" />
    <result column="cl_prono" property="clProno" jdbcType="VARCHAR" />
    <result column="cl_rsvno" property="clRsvno" jdbcType="VARCHAR" />
    <result column="cl_roomno" property="clRoomno" jdbcType="INTEGER" />
    <result column="cl_code" property="clCode" jdbcType="VARCHAR" />
    <result column=" cl_batch" property="clBatch" jdbcType="VARCHAR" />
    <result column="cl_edit_con" property="clEditCon" jdbcType="VARCHAR" />
    <result column="cl_before_edit" property="clBeforeEdit" jdbcType="VARCHAR" />
    <result column="cl_after_edit" property="clAfterEdit" jdbcType="VARCHAR" />
    <result column="cl_build_date" property="clBuildDate" jdbcType="TIMESTAMP" />
    <result column="cl_create_by" property="clCreateBy" jdbcType="VARCHAR" />
    <result column="cl_operation_date" property="clOperationDate" jdbcType="TIMESTAMP" />
    <result column="cl_terminal" property="clTerminal" jdbcType="VARCHAR" />
    <result column="cl_result" property="clResult" jdbcType="SMALLINT" />
    <result column="cl_frame" property="clFrame" jdbcType="VARCHAR" />
    <result column="cl_before_view" property="clBeforeView" jdbcType="VARCHAR" />
    <result column="cl_after_view" property="clAfterView" jdbcType="VARCHAR" />
  </resultMap>
  
  <sql id="Base_Column_List" >
    cl_id, cl_grp_id, cl_hotel_id, cl_client_ip, cl_server_ip, cl_biz_date, cl_system, 
    cl_modular, cl_fun, cl_operation, cl_accno, cl_groupno, cl_prono, cl_rsvno, cl_roomno, 
    cl_code, " cl_batch", cl_edit_con, cl_before_edit, cl_after_edit, cl_build_date, 
    cl_create_by, cl_operation_date, cl_terminal, cl_result, cl_frame,cl_before_view,cl_after_view
  </sql>
  
  <select id ="selectLogByClass" resultMap="BaseResultMap" parameterType="com.sstc.hmis.log.dbaccess.data.OperationLog">
  		 select 
    		<include refid="Base_Column_List" />
    	from ${tableName}
    	where cl_hotel_id = #{clHotelId}
    	<if test="clAccnos !=null and clAccnos.length >0 ">
    		and cl_accno in
    		<foreach collection="clAccnos" item="accno" open="(" separator="," close=")">
    			    #{accno}
    		</foreach>
    	</if>
    	<if test="clRoomnos !=null and clRoomnos.length >0 ">
    		and CAST(cl_roomno as VARCHAR) in
    		<foreach collection="clRoomnos" item="roomno" open="(" separator="," close=")">
    			    #{roomno}
    		</foreach>
    	</if>
    	<if test="clModular !=null and clModular !='' ">
    		and cl_modular = #{clModular}
    	</if>
    	<if test="clFun !=null and clFun !='' ">
    		and cl_fun = #{clFun}
    	</if>
    	<if test="clOperation !=null and clOperation !='' ">
    		and cl_operation = #{clOperation}
    	</if>
    	<if test="clCreateBys !=null and clCreateBys.length >0">
    		and cl_create_by in
    		<foreach collection="clCreateBys" item="createBy" open="(" separator="," close=")">
    			    #{createBy}
    		</foreach>
    	</if>
    	<if test="startDate != null and startDate !=''">
        	and cl_operation_date  <![CDATA[ >= ]]> to_date(#{startDate},'yyyy-MM-dd HH:mm:ss')
        </if>
        <if test="endDate != null and endDate !=''">
        	and cl_operation_date  <![CDATA[ < ]]> to_date(#{endDate},'yyyy-MM-dd HH:mm:ss') + 1
        </if>
        order by cl_operation_date desc 
  </select>
  
  <select id="selectLogFun" resultType="java.lang.String" parameterType="java.lang.String">
  		select distinct cl_fun from ${tableName}
  		where cl_hotel_id = #{clHotelId}
  </select>
  
  <select id="selectLogType" resultType="java.lang.String" parameterType="java.lang.String">
  		select distinct cl_operation from ${tableName}
  		where cl_fun = #{clFun}
  		and cl_hotel_id = #{clHotelId}
  </select>
  
  <select id="selectLogById" resultMap="BaseResultMap" parameterType="java.lang.String">
  		 select 
    		<include refid="Base_Column_List" />
    	from ${tableName}
    	where cl_id = #{clId}
  </select>
  
</mapper>